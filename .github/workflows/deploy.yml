name: Deployment Workflow

on:
  workflow_dispatch:
    inputs:
      release_name:
        description: 'Enter release/tag name (e.g., v1.0.3)'
        required: true
      simulate:
        description: 'Should the deployment succeed or fail?'
        required: true
        type: choice
        options: [success, fail]
      environment:
        description: 'Select environment'
        required: true
        default: 'production'
        type: choice
        options: [staging, production]

jobs:
  deploy:
    runs-on: ubuntu-latest
    env:
      ENVIRONMENT: ${{ github.event.inputs.environment }}
      RELEASE_NAME: ${{ github.event.inputs.release_name }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v3
        with:
          ref: ${{ env.RELEASE_NAME }}

      - name: Simulate Deployment
        run: |
          echo "ðŸš€ Deploying $RELEASE_NAME to $ENVIRONMENT..."
          if [ "${{ github.event.inputs.simulate }}" = "success" ]; then
            echo "Deployment Successful"
          else
            echo "Deployment Failed"
            exit 1
          fi

      - name: Trigger Rollback on Failure
        if: failure()
        uses: peter-evans/workflow-dispatch@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          workflow: Rollback Workflow.yml
          ref: main
          inputs:
            environment: ${{ env.ENVIRONMENT }}
            release_name: ${{ env.RELEASE_NAME }}
